(swan.webpackJsonp=swan.webpackJsonp||[]).push([[78],{"159":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},A=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Q=n(0),j=_interopRequireDefault(Q),q=n(1),F=n(2),D=n(4),C=_interopRequireDefault(D),N=_interopRequireDefault(n(6)),$=n(12),J=n(7);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}n(160);var a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Recharge,j.default.Component),r(Recharge,[{"key":"_constructor","value":function _constructor(e){(function get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:get(a,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0})(Recharge.prototype.__proto__||Object.getPrototypeOf(Recharge.prototype),"_constructor",this).call(this,e),this.$$refs=new j.default.RefsArray}},{"key":"_createData","value":function _createData(e,t,n){var r=this;this.__state=e||this.state||{},this.__props=t||this.props||{},this.$prefix;var a=(0,Q.useState)([]),o=A(a,2),i=o[0],c=o[1],u=(0,Q.useState)(0),s=A(u,2),f=s[0],l=s[1],d=(0,Q.useState)(0),p=A(d,2),h=p[0],g=p[1],y=(0,Q.useState)(0),v=A(y,2),_=v[0],S=v[1],m=(0,Q.useState)(!1),O=A(m,2),b=O[0],R=O[1];function Ba(e){return new Promise(function(t,n){t({"code":0}),(0,F.userCheckDouyinRecharge)({"order_no":e}).then(function(e){(0,C.default)(e.errmsg),"ok"==e.errcode&&(l(e.integral),t({"code":0}))}).catch(function(e){(0,C.default)("支付失败"),n(e)})})}(0,Q.useEffect)(function(){(0,F.getRechargeList)().then(function(e){if("ok"==e.errcode){c(e.list),l(parseInt(e.user.integral));var t=e.list.findIndex(function(e){return"1"==e.default});g(t);var n=(0,J.getPointNumber)(e.list[t].price,e.list[t].integral);S(n)}else(0,D.ShowActionModal)({"msg":e.errmsg,"success":function success(){j.default.navigateBack()}})}),j.default.canIUse&&j.default.canIUse("requestWxPayment")&&R(!0)},[]);var w=function douyinProPay(){var e=i[h].id;(0,F.userDouyinRecharge)({"integral_price_id":e}).then(function(e){var t=e.data.biteOrderInfo.out_order_no;tt.pay({"orderInfo":e.data.biteOrderInfo,"service":3,"getOrderStatus":function getOrderStatus(){return Ba(t)},"success":function success(e){0==e.code&&(0,C.default)("支付成功"),9==e.code?Ba(t):(0,C.default)("支付失败")},"fail":function fail(){(0,C.default)("支付失败")}})}).catch(function(e){return console.log(e)})},E=function handleQQPay(n){var e=i[h].id;(0,F.userQQRecharge)({"priceType":e}).then(function(e){var t=e.data;qq.requestPayment({"package":"prepay_id="+t.prepay_id,"success":function success(){(0,C.default)("支付成功"),l(f+n)},"fail":function fail(){(0,C.default)("支付失败")}})})},P=function handleQQWeChatPay(o){var e=i[h].id;(0,F.userQQRecharge)({"priceType":e,"is_wx":!0}).then(function(e){var t=e.data,n=t.mweb_url,r=t.order_no,a=t.referer;qq.requestWxPayment({"url":n,"referer":a,"success":function success(){x(r,o)},"fail":function fail(e){j.default.showModal({"content":"支付失败"+JSON.stringify(e)})}})})},I=function weixinProPay(n){j.default.login({"success":function success(e){(0,F.getRechargeOpenid)(e.code).then(function(e){var t={"priceType":i[h].id,"openid":e.openid};(0,F.getRechargeOrder)(t).then(function(e){j.default.requestPayment(B({},e.payData)).then(function(){l(f+n),j.default.showModal({"title":"恭喜您","content":"您已成功充值"+n+"个积分","cancelText":"会员中心","confirmText":"继续充值","success":function success(e){e.cancel&&j.default.reLaunch({"url":"/pages/index/index?type="+$.MEMBER})}})}).catch(function(){(0,D.errMsg)("用户取消充值")})}).catch(function(){(0,D.errMsg)("网络异常，充值失败，客服电话"+q.SERVERPHONE)})}).catch(function(){(0,D.ShowActionModal)({"msg":"充值失败，请联系客服电话"+q.SERVERPHONE})})}})},k=function baiduProPay(t){var e=i[h].id;console.log(e),(0,F.getBaiduTpOrderId)({"priceType":e}).then(function(e){"ok"==e.errcode?swan.requestPolymerPayment({"orderInfo":B({},e.payData),"success":function success(){T(e.payData.tpOrderId,t)},"fail":function fail(e){(0,D.ShowActionModal)({"msg":e.errMsg})}}):(0,D.ShowActionModal)({"msg":"支付失败，请联系客服电话 "+q.SERVERPHONE})})},x=function checkQqOrderStatusFun(e,t){(0,F.checkBaiduOrderStatusAction)({"tpOrderId":e}).then(function(e){"ok"==e.errcode&&(2==e.data.order_status?(l(f+t),j.default.showToast({"title":"支付成功","icon":"none"})):j.default.showToast({"title":"支付失败","icon":"none"}))})},T=function checkBaiduOrderStatusFun(e,t){var n=setInterval(function(){(0,F.checkBaiduOrderStatusAction)({"tpOrderId":e}).then(function(e){"ok"==e.errcode&&2==e.data.order_status&&(l(f+t),clearInterval(n),(0,D.ShowActionModal)({"msg":"支付成功"}))})},1e3)};this.anonymousFunc1=function(){return function userRechargeAction(){var t=i[h].integral;if(q.SERIES==q.WEIXINSERIES)return I(t),!1;if(q.SERIES==q.ZIJIESERIES)w();else if(q.SERIES==q.BAIDUSERIES)k(t);else if(q.SERIES==q.QQSERIES){var e=[];e=b?["QQ支付","微信支付"]:["QQ支付"],j.default.showActionSheet({"itemList":e,"success":function success(e){0==e.tapIndex&&E(t),1==e.tapIndex&&P(t)},"fail":function fail(){(0,C.default)("支付失败")}})}}()};var M=i.map(function(e,t){e={"privateOriginal":(0,Q.internal_get_original)(e)};var n="gezzz"+t;return r.anonymousFunc0Map[n]=function(){return function userChooseItem(n){g(n);var e=(0,J.getPointNumber)(i[n].price,i[n].integral);S(e);var t=JSON.parse(JSON.stringify(i));t.map(function(e,t){e.default=t==n?"1":"0"}),c(t)}(t)},{"_$indexKey":n,"loopState__temp2":(0,N.default)({"recharge-list-box":!0,"recharge-list-box-active":t===h}),"privateOriginal":e.privateOriginal}});return Object.assign(this.__state,{"loopArray60":M,"lists":i,"integral":f,"current":h,"price":_}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(e){for(var t,n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return this.anonymousFunc0Map[e]&&(t=this.anonymousFunc0Map)[e].apply(t,r)}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}}]),Recharge);function Recharge(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Recharge);var e=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Recharge.__proto__||Object.getPrototypeOf(Recharge)).apply(this,arguments));return e.config={"navigationBarTitleText":"用户充值积分","navigationBarBackgroundColor":"#0099ff","navigationBarTextStyle":"white","backgroundTextStyle":"dark"},e.$usedState=["loopArray60","lists","integral","current","price"],e.anonymousFunc0Map={},e.customComponents=["AtMessage"],e}a.$$events=["anonymousFunc0","anonymousFunc1"],a.$$componentPath="pages/recharge/index",a.config={"navigationBarTitleText":"用户充值积分","navigationBarBackgroundColor":"#0099ff","navigationBarTextStyle":"white","backgroundTextStyle":"dark"},t.default=a,Page(n(0).default.createComponent(a,!0))},"160":function(e,t,n){}},[[159,0,1]]]);