(swan.webpackJsonp=swan.webpackJsonp||[]).push([[67],{"140":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{"value":!0});var V=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,e){var n=[],a=!0,o=!1,r=void 0;try{for(var i,u=t[Symbol.iterator]();!(a=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);a=!0);}catch(t){o=!0,r=t}finally{try{!a&&u.return&&u.return()}finally{if(o)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t};function defineProperties(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var J=n(0),K=_interopRequireDefault(J),Q=n(2),W=n(1),X=n(5),Y=n(9),Z=n(7),tt=n(4),et=_interopRequireDefault(tt);n(141);var nt=n(3),at=n(15);function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}var ot=Math.PI,o=(function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{"constructor":{"value":t,"enumerable":!1,"writable":!0,"configurable":!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(RecruitMap,K.default.Component),a(RecruitMap,[{"key":"_constructor","value":function _constructor(t){(function get(t,e,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,e);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:get(o,e,n)}if("value"in a)return a.value;var r=a.get;return void 0!==r?r.call(n):void 0})(RecruitMap.prototype.__proto__||Object.getPrototypeOf(RecruitMap.prototype),"_constructor",this).call(this,t),this.$$refs=new K.default.RefsArray}},{"key":"_createData","value":function _createData(t,e,n){var o=this;this.__state=t||this.state||{},this.__props=e||this.props||{};var a=this.$prefix,r=(0,J.genCompid)(a+"$compid__48"),i=V(r,2),u=i[0],s=i[1],c=(0,nt.useSelector)(function(t){return t.RecruitAction}),l=(0,J.useRouter)().params.id||"",f=(0,J.useState)([]),p=V(f,2),y=p[0],d=p[1],m=c.area,h=c.positionStatus,g=(0,nt.useDispatch)();(0,J.useEffect)(function(){var t=K.default.getStorageSync(X.Areas);t?d(t):(0,Q.getAllAreas)().then(function(t){K.default.setStorageSync(X.Areas,t),d(t)})},[]);var v=(0,J.useState)({"id":"","pid":"","city":"","ad_name":""}),_=V(v,2),S=_[0],F=_[1],M=(0,J.useState)(!1),b=V(M,2),A=b[0],C=b[1],P=(0,J.useState)(""),w=V(P,2),O=w[0],R=w[1],I=(0,J.useState)([]),k=V(I,2),L=k[0],T=k[1],U=(0,J.useState)([]),x=V(U,2),$=x[0],j=x[1],D=(0,J.useState)(!1),H=V(D,2),E=H[0],z=H[1];function Ta(t){return parseFloat(t)*ot/180}(0,J.useEffect)(function(){!function initUserLocationCity(){var t=K.default.getStorageSync(X.UserLocationCity);if(t){var e=(0,Y.getCityInfo)(t,1),n={"id":e.id,"pid":e.pid,"ad_name":e.ad_name,"city":e.name};l||h&&(g((0,at.setArea)({"id":e.id,"name":e.name,"ad_name":e.ad_name})),g((0,at.setPositionStaus)(!1))),F(n)}else N()}(),B()},[]);var N=function handleGps(){K.default.getSetting({"success":function success(t){null!=t.authSetting["scope.userLocation"]&&1!=t.authSetting["scope.userLocation"]?K.default.showModal({"title":"是否授权当前位置","content":"需要获取您的地理位置，请确认授权，否则将不能为你自动推荐位置","success":function success(t){t.confirm&&K.default.openSetting({"success":function success(t){1==t.authSetting["scope.userLocation"]?((0,et.default)("授权成功"),(0,Z.userAuthLoction)().then(function(t){var e=K.default.getStorageSync(X.UserLocationCity),n=(0,Y.getCityInfo)(e,1);g((0,at.setArea)({"name":n.name,"id":n.id,"ad_name":n.ad_name})),g((0,at.setPositionStaus)(!1))})):(0,et.default)("授权失败")}})}}):(0,Z.userAuthLoction)().then(function(t){if(t){var e=K.default.getStorageSync(X.UserLocationCity),n=(0,Y.getCityInfo)(e,1);g((0,at.setArea)({"name":n.name,"id":n.id,"ad_name":n.ad_name})),g((0,at.setPositionStaus)(!1))}})}})};function Va(t){C(t),z(!1)}function _a(e){console.log("item",e),(0,Q.checkAdcodeValid)(e.adcode).then(function(t){"ok"==t.errcode?(at.setAreaInfo&&(function setUserPublishAreaHistoryItem(e){var t=K.default.getStorageSync(X.UserPublishAreaHistory);if(t){var n=t.findIndex(function(t){return t.location===e.location&&t.name===e.name&&t.adcode==e.adcode});t.unshift(e),-1!==n&&t.splice(n,1),t.splice(W.UserPublishAreaHistoryMaxNum),j(t),K.default.setStorageSync(X.UserPublishAreaHistory,t)}else j([e]),K.default.setStorageSync(X.UserPublishAreaHistory,[e])}(e),g((0,at.setAreaInfo)({"title":e.name,"location":e.location,"adcode":e.adcode,"info":e.district,"areaId":e.areaId})),g((0,at.setArea)({"name":e.cityName,"id":e.areaId||"","ad_name":e.ad_name}))),K.default.navigateBack()):(0,tt.ShowActionModal)({"msg":t.errmsg})}).catch(function(){(0,et.default)("网络错误，请求失败！")})}(0,J.useEffect)(function(){(0,Z.getAmapPoiList)(m.ad_name+O).then(function(e){var n=K.default.getStorageSync(X.UserLocation),t=e.filter(function(t){return t.name&&t.adcode&&"string"==typeof t.location});t.forEach(function(t){t.distance=function getGreatCircleDistance(t,e){if(!t)return"";var n=t.split(","),a=e.split(","),o=Ta(n[0]),r=Ta(a[0]),i=o-r,u=Ta(n[1])-Ta(a[1]),s=2*Math.asin(Math.sqrt(Math.pow(Math.sin(i/2),2)+Math.cos(o)*Math.cos(r)*Math.pow(Math.sin(u/2),2)));return s*=6378137,(s=parseInt((Math.round(1e4*s)/1e4).toFixed(2)))<1e3?s+"米":(s/1e3).toFixed(1)+"千米"}(n,t.location),t.cityName=e[0].name.slice(0,2),t.areaId=m.id,t.ad_name=m.ad_name}),T(t)})},[O,m]);var B=function initUserPublishAreaHistory(){var t=K.default.getStorageSync(X.UserPublishAreaHistory)||[];j(t)};this.anonymousFunc0=function(){return Va(!0)},this.anonymousFunc1=function(t){return function userClickInputAction(t){t.detail.value||z(!0)}(t)},this.anonymousFunc2=function(t){return function userEnterPosition(t){var e=t.detail.value;R(e),z(!e)}(t)},this.anonymousFunc3=function(){return function closeHistoryClient(){z(!1),R("")}()},this.anonymousFunc4=function(){return function userCloseMap(){K.default.navigateBack()}()};var G=E?$.map(function(t,e){t={"privateOriginal":(0,J.internal_get_original)(t)};var n=E?e+e:null,a="ffzzz"+e;return o.anonymousFunc5Map[a]=function(){return _a(t.privateOriginal)},{"loopState__temp2":n,"_$indexKey":a,"privateOriginal":t.privateOriginal}}):[],q=L.map(function(t,e){t={"privateOriginal":(0,J.internal_get_original)(t)};var n=e+e,a="fgzzz"+e;return o.anonymousFunc6Map[a]=function(){return _a(t.privateOriginal)},{"loopState__temp4":n,"_$indexKey2":a,"privateOriginal":t.privateOriginal}});return A&&J.propsManager.set({"data":y,"area":m.name,"userLoc":S,"userTapCityBtn":Va},s,u),Object.assign(this.__state,{"loopArray48":G,"loopArray49":q,"$compid__48":s,"smAreaText":O,"showHistory":E,"histroyList":$,"lists":L,"IMGCDNURL":W.IMGCDNURL,"showCity":A,"area":m}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}},{"key":"anonymousFunc2","value":function anonymousFunc2(){}},{"key":"anonymousFunc3","value":function anonymousFunc3(){}},{"key":"anonymousFunc4","value":function anonymousFunc4(){}},{"key":"anonymousFunc5","value":function anonymousFunc5(t){for(var e,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return this.anonymousFunc5Map[t]&&(e=this.anonymousFunc5Map)[t].apply(e,a)}},{"key":"anonymousFunc6","value":function anonymousFunc6(t){for(var e,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return this.anonymousFunc6Map[t]&&(e=this.anonymousFunc6Map)[t].apply(e,a)}}]),RecruitMap);function RecruitMap(){!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,RecruitMap);var t=function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(RecruitMap.__proto__||Object.getPrototypeOf(RecruitMap)).apply(this,arguments));return t.config={"navigationBarTitleText":"选择发布地址"},t.$usedState=["loopArray48","loopArray49","$compid__48","smAreaText","showHistory","histroyList","lists","IMGCDNURL","showCity","area"],t.anonymousFunc5Map={},t.anonymousFunc6Map={},t.customComponents=["Cities"],t}o.$$events=["anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3","anonymousFunc4","anonymousFunc5","anonymousFunc6"],o.$$componentPath="pages/map/recruit/index",o.config={"navigationBarTitleText":"选择发布地址"},e.default=o,Page(n(0).default.createComponent(o,!0))},"141":function(t,e,n){}},[[140,0,1]]]);